
// Course structures for all technologies
const courseStructures = {
    html: {
        title: "HTML Tutorial",
        sections: [
            {
                title: "HTML Tutorial",
                lessons: [
                    "HTML HOME", "HTML Introduction", "HTML Editors", "HTML Basic", "HTML Elements",
                    "HTML Attributes", "HTML Headings", "HTML Paragraphs", "HTML Styles", "HTML Formatting",
                    "HTML Quotations", "HTML Comments", "HTML Colors", "HTML CSS", "HTML Links",
                    "HTML Images", "HTML Favicon", "HTML Page Title", "HTML Tables", "HTML Lists",
                    "HTML Block & Inline", "HTML Div", "HTML Classes", "HTML Id", "HTML Iframes",
                    "HTML JavaScript", "HTML File Paths", "HTML Head", "HTML Layout", "HTML Responsive",
                    "HTML Computercode", "HTML Semantics", "HTML Style Guide", "HTML Entities",
                    "HTML Symbols", "HTML Emojis", "HTML Charsets", "HTML URL Encode", "HTML vs. XHTML"
                ]
            },
            {
                title: "HTML Forms",
                lessons: [
                    "HTML Forms", "HTML Form Attributes", "HTML Form Elements",
                    "HTML Input Types", "HTML Input Attributes", "Input Form Attributes"
                ]
            },
            {
                title: "HTML Graphics",
                lessons: ["HTML Canvas", "HTML SVG"]
            },
            {
                title: "HTML Media",
                lessons: ["HTML Media", "HTML Video", "HTML Audio", "HTML Plug-ins", "HTML YouTube"]
            },
            {
                title: "HTML APIs",
                lessons: [
                    "HTML Web APIs", "HTML Geolocation", "HTML Drag and Drop",
                    "HTML Web Storage", "HTML Web Workers", "HTML SSE"
                ]
            },
            {
                title: "HTML Examples",
                lessons: [
                    "HTML Examples", "HTML Editor", "HTML Quiz", "HTML Exercises",
                    "HTML Website", "HTML Syllabus", "HTML Study Plan", "HTML Interview Prep",
                    "HTML Bootcamp", "HTML Certificate", "HTML Summary", "HTML Accessibility"
                ]
            }
        ]
    },
    css: {
        title: "CSS Tutorial",
        sections: [
            {
                title: "CSS Tutorial",
                lessons: [
                    "CSS HOME", "CSS Introduction", "CSS Syntax", "CSS Selectors", "CSS How To",
                    "CSS Comments", "CSS Colors", "CSS Backgrounds", "CSS Borders", "CSS Margins",
                    "CSS Padding", "CSS Height/Width", "CSS Box Model", "CSS Outline", "CSS Text",
                    "CSS Fonts", "CSS Icons", "CSS Links", "CSS Lists", "CSS Tables", "CSS Display",
                    "CSS Max-width", "CSS Position", "CSS Z-index", "CSS Overflow", "CSS Float",
                    "CSS Inline-block", "CSS Align", "CSS Combinators", "CSS Pseudo-classes",
                    "CSS Pseudo-elements", "CSS Opacity", "CSS Navigation Bar", "CSS Dropdowns",
                    "CSS Image Gallery", "CSS Image Sprites", "CSS Attr Selectors", "CSS Forms",
                    "CSS Counters", "CSS Website Layout", "CSS Units", "CSS Specificity",
                    "CSS !important", "CSS Math Functions"
                ]
            },
            {
                title: "CSS Advanced",
                lessons: [
                    "CSS Rounded Corners", "CSS Border Images", "CSS Backgrounds", "CSS Colors",
                    "CSS Color Keywords", "CSS Gradients", "CSS Shadows", "CSS Text Effects",
                    "CSS Web Fonts", "CSS 2D Transforms", "CSS 3D Transforms", "CSS Transitions",
                    "CSS Animations", "CSS Tooltips", "CSS Image Styling", "CSS Image Centering",
                    "CSS Image Filters", "CSS Image Shapes", "CSS object-fit", "CSS object-position",
                    "CSS Masking", "CSS Buttons", "CSS Pagination", "CSS Multiple Columns",
                    "CSS User Interface", "CSS Variables", "CSS @property", "CSS Box Sizing",
                    "CSS Media Queries", "CSS MQ Examples"
                ]
            },
            {
                title: "CSS Flexbox",
                lessons: ["Flexbox Intro", "Flex Container", "Flex Items", "Flex Responsive"]
            },
            {
                title: "CSS Grid",
                lessons: ["Grid Intro", "Grid Columns/Rows", "Grid Container", "Grid Item"]
            },
            {
                title: "CSS Responsive",
                lessons: [
                    "RWD Intro", "RWD Viewport", "RWD Grid View", "RWD Media Queries",
                    "RWD Images", "RWD Videos", "RWD Frameworks", "RWD Templates"
                ]
            }
        ]
    },
    javascript: {
        title: "JavaScript Tutorial",
        sections: [
            {
                title: "JS Tutorial",
                lessons: [
                    "JS HOME", "JS Introduction", "JS Where To", "JS Output", "JS Statements",
                    "JS Syntax", "JS Comments", "JS Variables", "JS Let", "JS Const",
                    "JS Operators", "JS Arithmetic", "JS Assignment", "JS Data Types", "JS Functions",
                    "JS Objects", "JS Object Properties", "JS Object Methods", "JS Object Display",
                    "JS Object Constructors", "JS Events", "JS Strings", "JS String Methods",
                    "JS String Search", "JS String Templates", "JS Numbers", "JS BigInt",
                    "JS Number Methods", "JS Number Properties", "JS Arrays", "JS Array Methods",
                    "JS Array Search", "JS Array Sort", "JS Array Iteration", "JS Array Const",
                    "JS Dates", "JS Date Formats", "JS Date Get Methods", "JS Date Set Methods",
                    "JS Math", "JS Random", "JS Booleans", "JS Comparisons", "JS If Else",
                    "JS Switch", "JS Loop For", "JS Loop For In", "JS Loop For Of",
                    "JS Loop While", "JS Break", "JS Iterables", "JS Sets", "JS Set Methods",
                    "JS Maps", "JS Map Methods", "JS typeof", "JS toString()", "JS Type Conversion",
                    "JS Destructuring", "JS Bitwise", "JS RegExp", "JS Precedence", "JS Errors",
                    "JS Scope", "JS Hoisting", "JS Strict Mode", "JS this Keyword",
                    "JS Arrow Function", "JS Classes", "JS Modules", "JS JSON", "JS Debugging",
                    "JS Style Guide", "JS Best Practices", "JS Mistakes", "JS Performance",
                    "JS Reserved Words"
                ]
            },
            {
                title: "JS Objects",
                lessons: [
                    "Object Definitions", "Object Prototypes", "Object Methods",
                    "Object Properties", "Object Get / Set", "Object Protection"
                ]
            },
            {
                title: "JS Functions",
                lessons: [
                    "Function Definitions", "Function Parameters", "Function Invocation",
                    "Function Call", "Function Apply", "Function Bind", "Function Closures"
                ]
            },
            {
                title: "JS Async",
                lessons: ["JS Callbacks", "JS Asynchronous", "JS Promises", "JS Async/Await"]
            },
            {
                title: "JS HTML DOM",
                lessons: [
                    "DOM Intro", "DOM Methods", "DOM Document", "DOM Elements", "DOM HTML",
                    "DOM Forms", "DOM CSS", "DOM Animations", "DOM Events", "DOM Event Listener",
                    "DOM Navigation", "DOM Nodes", "DOM Collections", "DOM Node Lists"
                ]
            }
        ]
    },
    react: {
        title: "React Tutorial",
        sections: [
            {
                title: "React Tutorial",
                lessons: [
                    "React Home", "React Intro", "React Get Started", "React Upgrade", "React ES6",
                    "React Render HTML", "React JSX", "React Components", "React Class", "React Props",
                    "React Events", "React Conditionals", "React Lists", "React Forms", "React Router",
                    "React Memo", "React CSS Styling", "React Sass Styling"
                ]
            },
            {
                title: "React Hooks",
                lessons: [
                    "What is a Hook?", "useState", "useEffect", "useContext", "useRef",
                    "useReducer", "useCallback", "useMemo", "Custom Hooks"
                ]
            },
            {
                title: "React Exercises",
                lessons: [
                    "React Compiler", "React Quiz", "React Exercises", "React Syllabus",
                    "React Study Plan", "React Server", "React Interview Prep", "React Certificate"
                ]
            }
        ]
    }
};

// Authentication and user management
let currentUser = null;

// Initialize course on page load
document.addEventListener('DOMContentLoaded', function() {
    // Get course from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const course = urlParams.get('course') || 'html';
    
    // Check if user is logged in
    checkLoginStatus();
    
    // Load course structure
    loadCourseStructure(course);
    
    // Mobile Navigation Toggle
    const mobileToggle = document.getElementById('mobileToggle');
    const navMenu = document.querySelector('.nav-menu');

    if (mobileToggle && navMenu) {
        mobileToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });
    }

    // Tab functionality for code editor
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
        });
    });

    // Update progress display
    updateProgressDisplay(course);
});

// Authentication functions
function checkLoginStatus() {
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showUserInfo();
    }
}

function showLoginModal() {
    document.getElementById('loginModal').style.display = 'block';
}

function hideLoginModal() {
    document.getElementById('loginModal').style.display = 'none';
}

function handleLogin(event) {
    event.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    // Simple demo authentication
    if (username === 'admin' && password === 'password') {
        currentUser = { username: username, loginTime: new Date().toISOString() };
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        showUserInfo();
        hideLoginModal();
        showNotification('Login successful!', 'success');
    } else {
        showNotification('Invalid credentials. Use admin/password', 'error');
    }
}

function logout() {
    currentUser = null;
    localStorage.removeItem('currentUser');
    document.getElementById('userInfo').style.display = 'none';
    document.getElementById('loginBtn').style.display = 'flex';
    showNotification('Logged out successfully!', 'success');
}

function showUserInfo() {
    document.getElementById('userName').textContent = currentUser.username;
    document.getElementById('userInfo').style.display = 'flex';
    document.getElementById('loginBtn').style.display = 'none';
}

// Course loading and management
function loadCourseStructure(course) {
    const structure = courseStructures[course];
    if (!structure) return;
    
    // Update page title and course name
    document.getElementById('pageTitle').textContent = `${structure.title} - CodeLearn`;
    document.getElementById('currentTech').textContent = structure.title;
    
    // Load sidebar navigation
    const sidebarNav = document.getElementById('sidebarNav');
    sidebarNav.innerHTML = '';
    
    structure.sections.forEach((section, sectionIndex) => {
        // Add section header
        if (section.title !== structure.title) {
            const sectionHeader = document.createElement('div');
            sectionHeader.className = 'section-header';
            sectionHeader.textContent = section.title;
            sidebarNav.appendChild(sectionHeader);
        }
        
        // Add lessons
        section.lessons.forEach((lesson, lessonIndex) => {
            const navItem = document.createElement('a');
            navItem.href = '#';
            navItem.className = 'nav-item';
            if (sectionIndex === 0 && lessonIndex === 0) {
                navItem.classList.add('active');
            }
            
            // Check if lesson is completed
            const isCompleted = isLessonCompleted(course, sectionIndex, lessonIndex);
            if (isCompleted) {
                navItem.classList.add('completed');
            }
            
            navItem.innerHTML = `
                <i class="fas ${isCompleted ? 'fa-check-circle' : 'fa-circle'}"></i>
                <span>${lesson}</span>
            `;
            
            navItem.addEventListener('click', (e) => {
                e.preventDefault();
                selectLesson(navItem, course, sectionIndex, lessonIndex, lesson);
            });
            
            sidebarNav.appendChild(navItem);
        });
    });
}

function selectLesson(element, course, sectionIndex, lessonIndex, lessonTitle) {
    // Remove active class from all nav items
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    // Add active class to clicked item
    element.classList.add('active');
    
    // Update content title
    document.getElementById('contentTitle').textContent = lessonTitle;
    
    // Store current lesson
    localStorage.setItem('currentLesson', JSON.stringify({
        course,
        sectionIndex,
        lessonIndex,
        title: lessonTitle
    }));
}

// Progress tracking
function isLessonCompleted(course, sectionIndex, lessonIndex) {
    const progress = JSON.parse(localStorage.getItem(`${course}_progress`) || '{}');
    return progress[`${sectionIndex}-${lessonIndex}`] || false;
}

function markAsComplete() {
    if (!currentUser) {
        showNotification('Please login to track progress', 'error');
        return;
    }
    
    const currentLesson = JSON.parse(localStorage.getItem('currentLesson') || '{}');
    if (!currentLesson.course) return;
    
    const { course, sectionIndex, lessonIndex } = currentLesson;
    const progressKey = `${course}_progress`;
    const progress = JSON.parse(localStorage.getItem(progressKey) || '{}');
    
    progress[`${sectionIndex}-${lessonIndex}`] = true;
    localStorage.setItem(progressKey, JSON.stringify(progress));
    
    // Update UI
    const activeNavItem = document.querySelector('.nav-item.active');
    if (activeNavItem) {
        activeNavItem.classList.add('completed');
        activeNavItem.querySelector('i').className = 'fas fa-check-circle';
    }
    
    // Update progress display
    updateProgressDisplay(course);
    updateMainPageProgress(course);
    
    showNotification('Lesson marked as complete!', 'success');
}

function updateProgressDisplay(course) {
    const structure = courseStructures[course];
    if (!structure) return;
    
    let totalLessons = 0;
    let completedLessons = 0;
    
    structure.sections.forEach((section, sectionIndex) => {
        section.lessons.forEach((lesson, lessonIndex) => {
            totalLessons++;
            if (isLessonCompleted(course, sectionIndex, lessonIndex)) {
                completedLessons++;
            }
        });
    });
    
    const percentage = totalLessons > 0 ? Math.round((completedLessons / totalLessons) * 100) : 0;
    
    // Update progress circle
    const circle = document.querySelector('.progress-ring-circle');
    const progressText = document.querySelector('.progress-text');
    
    if (circle && progressText) {
        const radius = circle.r.baseVal.value;
        const circumference = radius * 2 * Math.PI;
        const offset = circumference - (percentage / 100) * circumference;
        
        circle.style.strokeDasharray = circumference;
        circle.style.strokeDashoffset = offset;
        progressText.textContent = percentage + '%';
    }
}

function updateMainPageProgress(course) {
    // Update progress on main page
    const structure = courseStructures[course];
    if (!structure) return;
    
    let totalLessons = 0;
    let completedLessons = 0;
    
    structure.sections.forEach((section, sectionIndex) => {
        section.lessons.forEach((lesson, lessonIndex) => {
            totalLessons++;
            if (isLessonCompleted(course, sectionIndex, lessonIndex)) {
                completedLessons++;
            }
        });
    });
    
    const percentage = totalLessons > 0 ? Math.round((completedLessons / totalLessons) * 100) : 0;
    localStorage.setItem(`${course}_overall_progress`, percentage);
}

function nextLesson() {
    const currentLesson = JSON.parse(localStorage.getItem('currentLesson') || '{}');
    if (!currentLesson.course) return;
    
    const { course, sectionIndex, lessonIndex } = currentLesson;
    const structure = courseStructures[course];
    
    // Find next lesson
    let nextSection = sectionIndex;
    let nextLesson = lessonIndex + 1;
    
    if (nextLesson >= structure.sections[nextSection].lessons.length) {
        nextSection++;
        nextLesson = 0;
    }
    
    if (nextSection < structure.sections.length) {
        const navItems = document.querySelectorAll('.nav-item');
        let currentIndex = 0;
        
        for (let s = 0; s < nextSection; s++) {
            currentIndex += structure.sections[s].lessons.length;
        }
        currentIndex += nextLesson;
        
        if (navItems[currentIndex]) {
            navItems[currentIndex].click();
        }
    } else {
        showNotification('You have completed all lessons!', 'success');
    }
}

// Code Editor Functions
function copyCode() {
    const codeEditor = document.getElementById('codeEditor');
    codeEditor.select();
    codeEditor.setSelectionRange(0, 99999);
    
    try {
        document.execCommand('copy');
        showNotification('Code copied to clipboard!', 'success');
    } catch (err) {
        showNotification('Failed to copy code', 'error');
    }
    
    window.getSelection().removeAllRanges();
}

function runCode() {
    const codeEditor = document.getElementById('codeEditor');
    const code = codeEditor.value;
    
    const newWindow = window.open('', '_blank');
    newWindow.document.write(code);
    newWindow.document.close();
    
    showNotification('Code executed in new window!', 'success');
}

// Notification System
function showNotification(message, type = 'info') {
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }

    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}-circle"></i>
        <span>${message}</span>
    `;
    
    if (!document.querySelector('#notification-styles')) {
        const styles = document.createElement('style');
        styles.id = 'notification-styles';
        styles.textContent = `
            .notification {
                position: fixed;
                top: 100px;
                right: 20px;
                background: var(--bg-card);
                backdrop-filter: var(--backdrop-blur);
                border: 1px solid var(--border-color);
                border-radius: 10px;
                padding: 1rem 1.5rem;
                color: var(--text-primary);
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                transform: translateX(400px);
                transition: transform 0.3s ease;
                box-shadow: var(--shadow-glass);
            }
            .notification.success { border-left: 4px solid #10b981; }
            .notification.error { border-left: 4px solid #ef4444; }
            .notification.info { border-left: 4px solid #3b82f6; }
            .notification.show { transform: translateX(0); }
            .modal {
                display: none;
                position: fixed;
                z-index: 10000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.5);
            }
            .modal-content {
                background: var(--bg-card);
                margin: 15% auto;
                padding: 2rem;
                border-radius: 20px;
                width: 400px;
                max-width: 90%;
                border: 1px solid var(--border-color);
            }
            .modal-content h2 {
                margin-bottom: 1rem;
                text-align: center;
            }
            .modal-content input {
                width: 100%;
                padding: 0.75rem;
                margin-bottom: 1rem;
                border: 1px solid var(--border-color);
                border-radius: 10px;
                background: var(--bg-darker);
                color: var(--text-primary);
            }
            .modal-content button {
                width: 100%;
                padding: 0.75rem;
                background: var(--gradient-primary);
                border: none;
                border-radius: 10px;
                color: white;
                font-weight: 600;
                cursor: pointer;
            }
            .close {
                color: var(--text-secondary);
                float: right;
                font-size: 28px;
                font-weight: bold;
                cursor: pointer;
            }
            .user-info {
                display: flex;
                align-items: center;
                gap: 1rem;
            }
            .logout-btn {
                background: var(--bg-card);
                border: 1px solid var(--border-color);
                border-radius: 20px;
                padding: 0.5rem 1rem;
                color: var(--text-primary);
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            .section-header {
                font-weight: 600;
                font-size: 0.9rem;
                color: var(--primary-color);
                margin: 1rem 0 0.5rem 0;
                padding: 0.5rem 1rem;
                background: rgba(102, 126, 234, 0.1);
                border-radius: 8px;
            }
            .nav-item.completed {
                background: rgba(16, 185, 129, 0.1);
                border-left: 3px solid #10b981;
            }
            .nav-item.completed i {
                color: #10b981;
            }
        `;
        document.head.appendChild(styles);
    }
    
    document.body.appendChild(notification);
    
    setTimeout(() => notification.classList.add('show'), 100);
    
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Add scroll effect to navbar
window.addEventListener('scroll', () => {
    const navbar = document.querySelector('.navbar');
    if (navbar) {
        if (window.scrollY > 50) {
            navbar.style.background = 'rgba(15, 15, 35, 0.98)';
        } else {
            navbar.style.background = 'rgba(15, 15, 35, 0.95)';
        }
    }
});
